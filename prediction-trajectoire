<?php
// prediction-trajectoire.php

header('Content-Type: application/json');

// Lire les données JSON envoyées en POST
$inputJSON = file_get_contents('php://input');
$input = json_decode($inputJSON, true);

// Vérifier que timeMinutes est fourni et valide
if (!isset($input['timeMinutes']) || !is_int($input['timeMinutes']) || $input['timeMinutes'] <= 0) {
    http_response_code(400);
    echo json_encode(['error' => 'Paramètre timeMinutes invalide ou manquant.']);
    exit;
}

$timeMinutes = $input['timeMinutes'];

// Nettoyer les données (sécurité)
$timeMinutes = intval($timeMinutes);

// Commande pour exécuter le script Python avec le temps en argument
// Ajuste le chemin vers python3 et le script predict.py selon ton environnement
$python = '/usr/bin/python3';
$script = __DIR__ . '/predict.py'; // si le script est dans le même dossier

// Exécuter la commande
$cmd = escapeshellcmd("$python $script $timeMinutes");
$output = shell_exec($cmd);

if ($output === null) {
    http_response_code(500);
    echo json_encode(['error' => 'Erreur lors de l\'exécution du script Python.']);
    exit;
}

// Essayer de décoder le JSON renvoyé par Python
$result = json_decode($output, true);

if ($result === null) {
    http_response_code(500);
    echo json_encode(['error' => 'Réponse JSON invalide du script Python.']);
    exit;
}

// Tout est ok, renvoyer les données JSON
echo json_encode($result);
